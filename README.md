# Watering-esp32

Machine for watering several flowers. Autonomous, but with a WEB interface and sending messages to Telegram. Based on a esp32 family microcontrollers.

## Общее описание

Ещё одна поливалка на просторах github.  
Умеет опрашивать несколько аналоговых датчиков влажности и включать что-то для полива цветов.  
Умеет отправлять уведомления о состоявшемся поливе.  
Подсчитывает общий расход воды.

## Зачем это вообще нужно?

Каждый человек, который решил попробовать что такое паяльник и электроника должен пройти несколько этапов.

1) собрать моргалку светодиодом blink. Можно с помощью микроконтроллера, но это не путь истинного Джидая, лучше на транзисторах или, на худой конец, на NE555.
2) собрать "погодную станцию" подключив к arduino какой-нибудь датчик.
3) сделать часики.
4) сделать свой фонарик, "с блэк-джеком и шлюхами" (с) Futurama.
5) вспомнить о цветах и сделать наконец-то поливалку.
6) собрать какого-нибудь робота. Ну хотя-бы манипулятор. Чаще собирают машинки.

Если все эти этапы пройдены то, возможно, паяльник был куплен не зря :smiley:

Лично у меня пройдены 5 обязательных этапов, 4 из них выложены тут на github. Только отдельную погодную станцию не делал, а включил функционал в часики. И на самом деле всем, что я делаю, я реально пользуюсь. Бесполезных изделий нет. Кроме blink :smiley:

## Какие поливалки существуют?

Есть как минимум два варианта поиска на githab. По тегу watering и по тегу polivalka. По второму, к слову, больше толковых проектов.

Я пересмотрел почти все, на что потратил пол дня, и вот какие варианты существуют.

1) пустой проект. Иногда с readme или даже презентацией: "мы всем класом подумали и решили, что поливалка это круто!" Таких примерно четверть!
2) проект простой и самодостаточный. То есть совсем простой. Большая часть из них просто периодически включает что-то. Часто через delay() :smiley: Иногда там ещё есть подключение датчика влажности и включение не только через промежутки времени, но и если влажность упадёт. Это уже круто!
3) проекты похожие на пункт 2, но имеющие какой-то экран и позволяющие что-то настроить с кнопок. Это хорошо, но лучше всё-таки управлять удалённо.
4) проекты компаньоны. Микроконтроллер в таких проектах используется только как средство подключить датчики и исполнительные механизмы. А управляет логикой или условный HomeAssistant или непосредственно компьютер, стоящий рядом. И на самом деле это хорошее решение, которе позволяет настроить гибкую логику, получать разные графики и, если постараться, то управлять через облако. При чем, есть проект, где логика обсчитывается в MathLab, только непонятно зачем. Или прикрученный искусственный интеллект пытается предсказать влажность и обеспечить более равномерный полив. В общем, наверное за такими проектами будущее, но есть минус в том, что надо держать включенным какой-то компьютер - сервер, пусть даже это вариант RaspberryPie. Да и в общем такой сервер удорожает проект. Но если он уже есть в доме, то однозначно хорошая тема.
5) самодостаточные проекты, вроде моего. Их не так много, но они реально интересны. Я с удовольствием посмотрел с какими проблемами столкнулись авторы и как они их решали. Теперь, когда я уже немного набил шишек, разные решения становятся более понятны.

## С какими проблемами сталкивается человек решивший сделать поливалку?

На самом деле их много :smiley: Вот некоторые из них:

1) несмотря на то, что за один раз расходуется не так много воды, но на длинном участке времени это приличный объём. Так моя поливалка на 4 насоса и 4 прожорливых цветка израсходовала за 20 дней 11 литров. Больше ведра! Нужна большая тара. В одном из проектов использовался бак от кулера на 16 литров. Я взял большой тазик.
2) чтобы вода не вытекла сразу после первого включения насоса, нужно использовать или мембранный насос (но обычно они намного дороже и имеют питание 12В), или располагать емкость на другом уровне относительно цветка. Если это насос, то он должен быть ниже уровня цветов. Если это управляемый клапан, то наоборот выше уровня цветов. К стати, в случае с управляемым запорным клапаном можно подключится к водопроводу. Но этот риск на любителя.
3) трубка к насосу должна подходить по размеру. К примеру я взял первое попавшееся - 6мм. И носик насоса тоже 6мм. Думаю понятно, что я устраивал садистские действия со шлангом, чтобы превратить 6мм в 7мм. Хорошо, что он выдержал.
4) цена вопроса определяется не стоимостью микроконтроллера, датчиков и насосов. А стоимостью шланга и проводов. Их надо много и в сумме они дороже электроники.
5) если цветов много, то длина шлангов и проводов должна быть разной, в зависимости от удаленности от емкости с водой.
6) в начале я купил реле для подключения насосов. Но они оказались настолько большими, тяжелыми и неудобными для подключения, что в итоге я использовал схему на полевых транзисторах. И в большинстве схем авторы пошли тем-же путём.
7) привлекает идея питать всё автономно, от аккумулятора. Но ток в момент старта насоса примерно 360мА, а во время работы 160мА. И это не включая потребления датчиков и самого микроконтроллера, даже если он будет большую часть времени спать. Кроме того, от 3.7В насосы работают совсем не резво. Ставить повышающий преобразователь - получить ещё больше потери емкости. И того, или надо собирать батарею приличной емкости, или не выпендриваться и работать от сети 230В. К стати, а как заряжать аккумуляторы? Бегать к ним с зарядкой? Впрочем один интересный по исполнению проект я нашел и автор утверждает, что он автономен 3 месяца...
8) датчик влажности надо брать емкостной, иначе он просто растворится за пару месяцев. Тоже касается и датчика уровня воды. В некоторых проектах применено интересное решение, при котором питание датчиков не постоянно, а только на момент опроса. Это требует дополнительных ног, что немного усложняет проект, тем не менее решение интересное и рабочее. Я же просто использовал емкостной датчик и вообще не ставил датчик уровня воды в баке.

## Схема

Пока не нарисовал. Собирал всё на скорую руку, на глаз, тем не менее всё заработало. Хотя и с третьего раза. Сниму все номиналы и добавлю фактическую схему.

Я использовал Lolin 32 lite, так как в начале планировал резервное питание. Но по факту плата без сети не работает, только отсылает сообщения через GSM, когда пропадает и когда включается электричество. Но вот по уровню сигнала WiFi это самая крутая плата, с которй я имел дело. Неожиданно. Так как Lolin NodeMCU v2 наоборот худшая, точнее полный кошмар. А выглядят похоже, тоже без модуля и антенна разведена на плате. Рекомендую! Но вообще, для подобных самоделок, если не заморачиваться с аккумулятором, то лучше подходит ESP32C3 Super Mini. Про ESP8266 надо забывать.

## Фотографии

Общий вид с тазиком:  
![общий вид](https://github.com/SerhiiLe/Watering-esp32/blob/main/PXL_20250720_080338035.jpg)

Вид на плату, рядом с разъёмами распаяно "реле", но полевых транзисторах, но они smd и с другой стороны платы.
![плата](https://github.com/SerhiiLe/Watering-esp32/blob/main/PXL_20250720_080514097.jpg)

## Планы

Актуальность таких проектов повышается к сезону отпусков и резко падает после. Но я постараюсь не забросить проект, а довести его до ума.
